# ✅ 实施检查清单

## 📅 验证日期: 2026-01-30

使用本清单确保 4K 高清贴图系统正确配置和使用。

---

## 阶段 1: 系统验证 ✅

### 1.1 功能测试

- [x] **运行测试脚本**
  ```bash
  python test_multipass.py
  ```
  - [x] 看到 "[OK] 所有测试通过!" 消息
  - [x] 多级降采样功能正常
  - [x] 配置文件正确加载
  - [x] 所有缩放模式工作正常

**状态**: ✅ 已完成（所有测试通过）

---

### 1.2 代码验证

- [x] **检查 tool.py**
  - [x] 行 187-230: `multi_pass_downscale()` 函数存在
  - [x] 行 233-328: `apply_scale_mode()` 集成多级降采样
  - [x] 行 330-387: `get_image_hd()` 使用 round() 精度
  - [x] 行 523: `pg.SCALED` 标志已启用

- [x] **检查 constants.py**
  - [x] 行 7-9: 逻辑分辨率为 800x600

- [x] **检查 display_config.json**
  - [x] `enable_multipass`: true
  - [x] `multipass_threshold`: 3.0
  - [x] `max_step_size`: 2.0
  - [x] 所有对象显示尺寸已配置

**状态**: ✅ 已完成（所有核心代码已实现）

---

## 阶段 2: 准备测试资源 ⬜

### 2.1 选择测试对象

- [ ] **推荐对象**: 豌豆射手（Peashooter）
  - 原始尺寸: 71x71 像素
  - 高清尺寸 (3x): 213x213 像素
  - 帧数: 约 13 帧
  - 文件位置: `resources/graphics/Plants/Peashooter/`

---

### 2.2 准备高清图片

**选择方法**（任选其一）:

#### 方法 A: AI 放大工具（推荐）

- [ ] **在线工具: waifu2x**
  1. [ ] 访问: https://waifu2x.udp.jp/
  2. [ ] 上传原图: `Peashooter_0.png`
  3. [ ] 设置: 放大 3 倍，降噪等级：中等
  4. [ ] 下载结果

- [ ] **桌面工具: waifu2x-caffe** (Windows)
  1. [ ] 下载: https://github.com/lltcggie/waifu2x-caffe/releases
  2. [ ] 安装并运行
  3. [ ] 输入文件夹: 选择 Peashooter 目录
  4. [ ] 设置倍率: 3x
  5. [ ] 批量处理

#### 方法 B: 图像编辑软件

- [ ] **Photoshop**
  1. [ ] 打开原图
  2. [ ] 图像 → 图像大小
  3. [ ] 宽度: 213，高度: 213
  4. [ ] 重采样: Bicubic Smoother
  5. [ ] 保存

- [ ] **GIMP（免费）**
  1. [ ] 打开原图
  2. [ ] 图像 → 缩放图像
  3. [ ] 宽度: 213，高度: 213
  4. [ ] 插值: Cubic
  5. [ ] 导出

---

### 2.3 替换文件

- [ ] **备份原文件**（推荐）
  ```bash
  copy resources\graphics\Plants\Peashooter\Peashooter_0.png resources\graphics\Plants\Peashooter\Peashooter_0_backup.png
  ```

- [ ] **复制高清图片**
  ```bash
  copy 你的高清图片\Peashooter_0_HD.png resources\graphics\Plants\Peashooter\Peashooter_0.png
  ```

- [ ] **可选**: 替换更多帧（建议 1-3 帧测试）
  - [ ] Peashooter_1.png
  - [ ] Peashooter_2.png

---

## 阶段 3: 测试效果 ⬜

### 3.1 启动游戏

- [ ] **运行游戏**
  ```bash
  python main.py
  ```

- [ ] **检查启动**
  - [ ] 游戏正常启动（无错误）
  - [ ] 窗口大小为 800x600
  - [ ] 启动时间可接受（3-5 秒）

---

### 3.2 默认窗口测试

- [ ] **观察豌豆射手**
  - [ ] 显示正常（尺寸正确）
  - [ ] 动画流畅
  - [ ] 无明显锯齿
  - [ ] 性能稳定（60 FPS）

- [ ] **进入关卡**
  - [ ] 选择豌豆射手卡片
  - [ ] 种植到地图上
  - [ ] 观察攻击动画

---

### 3.3 窗口放大测试

- [ ] **最大化窗口**
  - [ ] 点击窗口最大化按钮
  - [ ] 或使用 Win + ↑ 键

- [ ] **观察画质**
  - [ ] 豌豆射手是否清晰
  - [ ] 是否有明显像素化
  - [ ] 对比替换前后的效果

- [ ] **性能检查**
  - [ ] FPS 是否稳定（60）
  - [ ] 是否有卡顿

---

### 3.4 效果对比

| 检查项 | 低清图 | 高清图 | 备注 |
|--------|--------|--------|------|
| 默认窗口 (800x600) | [ ] 清晰 | [ ] 清晰 | 两者差别不大 |
| 放大窗口 (1.5x) | [ ] 轻微模糊 | [ ] 清晰 | 高清图开始体现优势 |
| 放大窗口 (2x) | [ ] 模糊 | [ ] 清晰 | 高清图优势明显 |
| 全屏 (4K) | [ ] 很模糊 | [ ] 很清晰 | 高清图优势最大 |

**测试结论**:
- [ ] 高清图效果明显优于低清图
- [ ] 性能符合预期（60 FPS）
- [ ] 可以继续批量替换资源

---

## 阶段 4: 配置优化（可选）⬜

### 4.1 评估当前效果

- [ ] **画质评分**（1-5 分）
  - 默认窗口: _____ 分
  - 放大窗口: _____ 分
  - 全屏显示: _____ 分

- [ ] **性能评分**（1-5 分）
  - 启动速度: _____ 分
  - 运行流畅度: _____ 分

---

### 4.2 决定是否优化

**如果画质 ≥ 4 分，性能 ≥ 4 分**:
- [ ] 保持默认配置（推荐）
- [ ] 跳过此阶段

**如果需要更高画质**（4K 显示器推荐）:
- [ ] 继续配置优化

---

### 4.3 修改配置文件

- [ ] **打开配置文件**
  ```
  source/data/entity/display_config.json
  ```

- [ ] **修改参数**
  ```json
  {
    "default": {
      "multipass_threshold": 2.0,  // 从 3.0 改为 2.0
      "max_step_size": 1.5         // 从 2.0 改为 1.5
    }
  }
  ```

- [ ] **保存文件**

---

### 4.4 重新测试

- [ ] **重新启动游戏**
  ```bash
  python main.py
  ```

- [ ] **对比效果**
  - [ ] 画质是否改善
  - [ ] 锯齿是否减少
  - [ ] 启动时间是否可接受

- [ ] **性能检查**
  - [ ] 启动时间: _____ 秒（预期 4-6 秒）
  - [ ] 运行 FPS: _____ （预期 60）

---

## 阶段 5: 批量准备资源（可选）⬜

### 5.1 评估工作量

**需要替换的资源**:

- [ ] **植物**（优先级高）
  - [ ] Peashooter: 13 帧
  - [ ] SunFlower: 约 10 帧
  - [ ] WallNut: 约 15 帧
  - [ ] Chomper: 约 13 帧
  - [ ] 其他植物: 约 15+ 种

- [ ] **僵尸**（优先级高）
  - [ ] Zombie: 约 20 帧
  - [ ] ConeheadZombie: 约 20 帧
  - [ ] BucketheadZombie: 约 20 帧
  - [ ] 其他僵尸: 约 5+ 种

- [ ] **UI 元素**（优先级中）
  - [ ] 卡片: 约 20 张
  - [ ] 背景: 约 5 张
  - [ ] 按钮、面板: 约 20 张

**总计**: 约 500-1000 张图片

**预计时间**: 1-3 小时（使用批量工具）

---

### 5.2 选择批量工具

**推荐工具**:

- [ ] **waifu2x-ncnn-vulkan** (GPU 加速，最快)
  - 下载: https://github.com/nihui/waifu2x-ncnn-vulkan/releases
  - 支持批量处理
  - 预计时间: 30-60 分钟

- [ ] **Real-ESRGAN** (AI 放大，最高质量)
  - 下载: https://github.com/xinntao/Real-ESRGAN
  - 质量最好但较慢
  - 预计时间: 1-2 小时

- [ ] **Photoshop 批处理**
  - 创建动作录制
  - 批量应用
  - 预计时间: 1-3 小时

---

### 5.3 批量处理步骤

**使用 waifu2x-ncnn-vulkan**:

- [ ] **下载并解压工具**

- [ ] **创建批处理脚本**
  ```batch
  @echo off
  REM process_plants.bat

  set TOOL=waifu2x-ncnn-vulkan.exe
  set INPUT=resources\graphics\Plants
  set OUTPUT=resources_hd\graphics\Plants
  set SCALE=3

  %TOOL% -i %INPUT% -o %OUTPUT% -s %SCALE% -n 2

  echo 完成！
  pause
  ```

- [ ] **运行批处理**
  ```bash
  process_plants.bat
  ```

- [ ] **检查结果**
  - [ ] 确认文件数量正确
  - [ ] 抽查图片质量
  - [ ] 确认尺寸正确（原尺寸 × 3）

- [ ] **替换到游戏目录**
  ```bash
  xcopy /Y /S resources_hd\graphics\Plants\* resources\graphics\Plants\
  ```

---

### 5.4 测试批量结果

- [ ] **启动游戏测试**
  ```bash
  python main.py
  ```

- [ ] **全面检查**
  - [ ] 所有植物显示正常
  - [ ] 所有僵尸显示正常
  - [ ] UI 元素显示正常
  - [ ] 动画流畅
  - [ ] 性能稳定

---

## 阶段 6: 性能调优（可选）⬜

### 6.1 性能基准测试

- [ ] **测试启动时间**
  - 第一次启动: _____ 秒
  - 第二次启动: _____ 秒
  - 平均启动时间: _____ 秒

- [ ] **测试运行性能**
  - 默认窗口 FPS: _____
  - 放大窗口 FPS: _____
  - 全屏 FPS: _____

- [ ] **测试内存占用**
  - 启动后内存: _____ MB
  - 进入关卡后内存: _____ MB

---

### 6.2 性能问题诊断

**如果启动时间 > 7 秒**:
- [ ] 检查是否使用了 4x 高清图（考虑降低到 3x）
- [ ] 检查配置参数是否过于严格（提高 threshold）
- [ ] 考虑只升级关键资源（植物、僵尸）

**如果运行 FPS < 60**:
- [ ] 检查是否有其他程序占用 GPU
- [ ] 检查是否图片尺寸配置错误
- [ ] 联系技术支持

**如果内存占用 > 500 MB**:
- [ ] 检查是否有图片未正确降采样
- [ ] 检查配置文件是否正确

---

### 6.3 优化措施

**优化启动时间**:

- [ ] **提高阈值**
  ```json
  "multipass_threshold": 4.0  // 从 3.0 或 2.0 提高
  ```

- [ ] **提高步长**
  ```json
  "max_step_size": 2.5  // 从 2.0 或 1.5 提高
  ```

- [ ] **降低图片倍率**
  - 从 4x 降低到 3x
  - 或从 3x 降低到 2x

**优化内存占用**:

- [ ] **只升级关键资源**
  - 植物和僵尸使用高清图
  - UI 保持低清图

---

## 阶段 7: 文档和备份 ⬜

### 7.1 创建文档

- [x] **系统验证报告**: HD_VALIDATION_REPORT.md
- [x] **快速开始指南**: 4K_QUICK_START.md
- [x] **实施完成总结**: IMPLEMENTATION_COMPLETE.md
- [x] **系统架构图解**: SYSTEM_DIAGRAM.md
- [x] **本检查清单**: CHECKLIST.md

---

### 7.2 备份文件

- [ ] **备份原始资源**
  ```bash
  mkdir resources_backup
  xcopy /S /Y resources\graphics\* resources_backup\graphics\
  ```

- [ ] **备份配置文件**
  ```bash
  copy source\data\entity\display_config.json source\data\entity\display_config.backup.json
  ```

- [ ] **创建恢复脚本**
  ```batch
  @echo off
  REM restore_original.bat

  echo 恢复原始资源...
  xcopy /S /Y resources_backup\graphics\* resources\graphics\
  copy source\data\entity\display_config.backup.json source\data\entity\display_config.json

  echo 完成！
  pause
  ```

---

### 7.3 记录配置

- [ ] **记录最终配置**
  - multipass_threshold: _____
  - max_step_size: _____
  - 使用的图片倍率: _____

- [ ] **记录性能数据**
  - 启动时间: _____ 秒
  - 运行 FPS: _____
  - 内存占用: _____ MB

- [ ] **记录遇到的问题和解决方案**
  - 问题 1: _________________________
    解决: _________________________
  - 问题 2: _________________________
    解决: _________________________

---

## 最终检查 ⬜

### 功能检查

- [ ] 游戏正常启动
- [ ] 所有图片显示正常
- [ ] 动画流畅
- [ ] 窗口可以自由缩放
- [ ] 放大窗口后画面清晰
- [ ] 性能稳定（60 FPS）

---

### 文档检查

- [ ] 已阅读快速开始指南
- [ ] 已阅读系统验证报告
- [ ] 已了解工作原理
- [ ] 已创建备份
- [ ] 已记录配置

---

### 满意度评价

**整体效果**（1-5 分）:
- 画质提升: _____ 分
- 性能表现: _____ 分
- 使用体验: _____ 分

**是否推荐给他人**: [ ] 是 [ ] 否

**备注**: ____________________________________

---

## 📊 进度总结

### 已完成阶段

- [x] 阶段 1: 系统验证 ✅
- [ ] 阶段 2: 准备测试资源
- [ ] 阶段 3: 测试效果
- [ ] 阶段 4: 配置优化（可选）
- [ ] 阶段 5: 批量准备资源（可选）
- [ ] 阶段 6: 性能调优（可选）
- [ ] 阶段 7: 文档和备份

**总进度**: 阶段 1 完成（系统验证）

**下一步**: 阶段 2 - 准备测试资源（参考 4K_QUICK_START.md）

---

## 🎯 推荐路径

### 快速路径（仅测试）

```
阶段 1: 系统验证 ✅
   ↓
阶段 2: 准备 1-2 张测试图片
   ↓
阶段 3: 测试效果
   ↓
完成！
```

**预计时间**: 15-30 分钟

---

### 完整路径（全面升级）

```
阶段 1: 系统验证 ✅
   ↓
阶段 2: 准备测试资源
   ↓
阶段 3: 测试效果
   ↓
阶段 4: 配置优化（4K 优化）
   ↓
阶段 5: 批量准备所有资源
   ↓
阶段 6: 性能调优
   ↓
阶段 7: 文档和备份
   ↓
完成！
```

**预计时间**: 2-4 小时

---

## 📞 获取帮助

**如果遇到问题**:

1. 查看文档:
   - 快速问题: 4K_QUICK_START.md
   - 详细说明: HD_VALIDATION_REPORT.md
   - 技术细节: HD_IMPLEMENTATION_SUMMARY.md

2. 运行测试:
   ```bash
   python test_multipass.py
   ```

3. 检查配置:
   - source/data/entity/display_config.json

---

**祝您使用愉快！享受 4K 高清游戏体验！** 🎮✨

---

**检查清单版本**: 1.0
**创建日期**: 2026-01-30
**适用于**: 4K 显示器高清贴图系统
